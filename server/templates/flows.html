<div class="modal fade" id="system-conf" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h4 class="modal-title" id="myModalLabel">System configuration</h4>
      </div>
      <div id="system-conf-info" class="modal-body">
        <h5>Nodes and entities configuration</h5>
        <ul id="system-conf-nodes">
        </ul>
        <h5>Flow configuration</h5>
        <ul id="system-conf-flow">
        </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="flow-preview" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h4 class="modal-title" id="myModalLabel2">Flow preview</h4>
      </div>
      <div id="flow-preview-info" class="modal-body">
        <img class="img-responsive center-block" src="" alt="Flow graph"/>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="flow-info" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h4 class="modal-title" id="myModalLabel3">Info</h4>
      </div>
      <div id="flow-info-text" class="modal-body">
          <p></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="flow-run" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
        <h4 class="modal-title" id="myModalLabel4">Run flow</h4>
      </div>
      <div id="flow-run-info" class="modal-body">
        <form id="flow-run-form">
          <input type="hidden" value="" id="flow-run-name">
          <label for="args">Flow arguments:</label>
          <textarea name="args" class="form-control" rows="5" id="args"></textarea>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" id="flow-run-button" class="btn btn-primary pull-right">Run flow</button>
      </div>
    </div>
  </div>
</div>

<h2>Flows</h2>

<div style="position: fixed; right: 2%; bottom: 2%">
  <div>
    <button type="button" class="btn btn-default btn-circle btn-lg" title="Download generated Python code" onclick="window.location.href='/config.py'">
      <span class="glyphicon glyphicon glyphicon-console" aria-hidden="true"></span>
    </button>
  </div>

  <div>
    <button type="button" class="btn btn-default btn-circle btn-lg" data-toggle="modal" data-target="#system-conf" title="Show configuration">
      <span class="glyphicon glyphicon glyphicon-list-alt" aria-hidden="true"></span>
    </button>
  </div>

  <div>
    <form enctype="multipart/form-data" action="/upload" method="post">
      <button type="button" class="btn btn-danger btn-circle btn-file btn-lg" title="Upload new configuration" onclick="document.getElementById('config-input').click()">
        <span class="glyphicon glyphicon glyphicon-plus-sign" aria-hidden="true"></span>
        <input id="config-input" type="file" style="display: none;" onchange="this.form.submit()" name="file">
      </button>
    </form>
  </div>
</div>

<table class="table table-striped table-hover">
  <tr>
     <th class="col-md-2 text-center">Action</th>
     <th class="col-md-3">Flow name</th>
     <th class="col-md-7">Nodes in flow</th>
  </tr>
{% for flow_name, task_names in flow_usage.items() %}
  <tr>
    <td>
      <center>
        <button type="button" class="btn btn-default" data-toggle="modal" data-target="#flow-preview" data-flowname="{{flow_name}}" title="Show flow visualization">
          <span class="glyphicon glyphicon glyphicon-eye-open" aria-hidden="true"></span>
        </button>
        <button type="button" class="btn btn-default" data-toggle="modal" data-target="#flow-run" data-flowname="{{flow_name}}" title="Run flow">
          <span class="glyphicon glyphicon glyphicon-cog" aria-hidden="true"></span>
        </button>
      </center>
    </td>
    <td><h5>{{flow_name}}</h5></td>
    <td><h5>TODO</h5></td>
  </tr>
{% endfor %}
</table>

<script src="/js/flows.js"></script>
